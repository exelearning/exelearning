/* TinyMCE EdiCuaTeX plugin – simplified */
(function() {
  tinymce.PluginManager.add('edicuatex', function(editor) {

    /* Custom Σ icon */
    editor.ui.registry.addIcon('edicuatex', '<svg width="24" height="24" focusable="false"><path fill-rule="evenodd" clip-rule="evenodd" d="M9 4.8c.1-.5.5-.8 1-.8h10a1 1 0 1 1 0 2h-9.2L8.3 19.2a1 1 0 0 1-1.7.4l-3.4-4.2a1 1 0 0 1 1.6-1.2l2 2.5L9 4.8Zm9.7 5.5c.4.4.4 1 0 1.4L17 13.5l1.8 1.8a1 1 0 1 1-1.4 1.4L15.5 15l-1.8 1.8a1 1 0 0 1-1.4-1.4l1.8-1.8-1.8-1.8a1 1 0 0 1 1.4-1.4l1.8 1.8 1.8-1.8a1 1 0 0 1 1.4 0Z"></path></svg>');

    function openLatexEditor() {
      const sel = editor.selection.getContent({ format: 'text' }).trim();
      const url = 'app/common/edicuatex/index.html' + (sel ? '?sel=' + encodeURIComponent(sel) : '');
      editor.windowManager.openUrl({
        title: 'EdiCuaTeX',
        url,
        width: 900,
        height: 600,
        buttons: []
      });
    }

    editor.ui.registry.addButton('edicuatex', {
      icon: 'edicuatex',
      tooltip: 'Insertar/Edit math',
      onAction: openLatexEditor
    });

    editor.ui.registry.addMenuItem('edicuatex', {
      icon: 'edicuatex',
      text: 'Insertar/Edit math',
      onAction: openLatexEditor
    });

    return {
      getMetadata: function () {
        return {
          name: 'EdiCuaTeX',
          url: 'https://github.com/jjdeharo/edicuatex'
        };
      }
    };
  });
})();
